<!DOCTYPE html>
<html>

<head>
    <title>添加列车 · Ticket System</title>
    <link rel="icon" href="../../static/arona.ico">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Modem514 EternalFir">
    <meta name="description" content="a simple web front end for course assignment">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="../../static/css/style.css">
    <style>
        .icon {
            display: inline-flex;
            background-color: rgb(11, 186, 239, 0.9);
            border-radius: 50%;
            padding: 20px;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        #greeting {
            background: linear-gradient(to right,#49BCFC,#3B92F8) !important;
        }
        .greeting-card {
            background-color: rgba(6, 121, 222, 0.9);
        }
        .card-icon {
            color: rgba(6, 121, 222, 0.7);
            font-size: 2.0rem;
            background-color: rgba(6, 121, 222, 0.2);
            border-radius: 50%;
            padding-left: 13px;
            padding-right: 13px;
            padding-bottom: 3px;
            padding-top: 3px;
        }
    </style>

</head>

<body>

    <div class="wrapper">
        <!-- Sidebar  -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <!-- <img src="../../static/arona-logo.gif" width="75%"> -->
                <i class="fas fa-user-shield"></i>
                <span class="px-2">管理员主页</span>
            </div>

            <ul class="list-unstyled components">
                <li>
                    <a href="/index">
                        <i class="fas fa-home"></i>
                        <span style="font-size:medium;">
                            <span>返回</span>首页
                        </span>
                    </a>
                </li>
                <li>
                    <a href="#infoSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="fas fa-users"></i>
                        <span style="font-size:medium;">
                            用户<span>管理</span>
                        </span>
                    </a>
                    <ul class="collapse list-unstyled" id="infoSubmenu">
                        <li>
                            <a href="/admin/add-user">添加用户</a>
                        </li>                       
                        <li>
                            <a href="/admin/query-user">用户查询</a>
                        </li>
                        <li>
                            <a href="/admin/modify-profile">用户修改</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#ticketSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="fas fa-train-subway"></i>
                        <span style="font-size:medium;">
                            列车<span>管理</span>
                        </span>
                    </a>
                    <ul class="collapse list-unstyled" id="ticketSubmenu">
                        <li>
                            <a href="/admin/add-train">添加列车</a>
                        </li>
                        <li>
                            <a href="/admin/release-train">发布列车</a>
                        </li>
                        <li>
                            <a href="/admin/delete-train">删除列车</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#sysSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="fas fa-computer"></i>
                        <span style="font-size:medium;">
                            系统<span>管理</span>
                        </span>
                    </a>
                    <ul class="collapse list-unstyled" id="sysSubmenu">
                        <li>
                            <a href="/admin/rollback">系统回滚</a>
                        </li>                       
                        <li>
                            <a href="/admin/clean">退出清空</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#othersSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="fas fa-briefcase"></i>
                        <span style="font-size:medium;">更多</span>
                    </a>
                    <ul class="collapse list-unstyled" id="othersSubmenu">
                        <li>
                            <a href="#">公告</a>
                        </li>
                        <li>
                            <a href="#">日志</a>
                        </li>
                        <li>
                            <a href="#">指南</a>
                        </li>
                        <li>
                            <a href="#">关于</a>
                        </li>
                    </ul>
                </li>
            </ul>

            <ul class="list-unstyled CTAs">
                <li>
                    <a href="#" class="profile text-center"><i class="fas fa-user"></i>个人中心</a>
                </li>
                <li>
                    <a href="#" class="logout text-center"><i class="fas fa-power-off"></i>退出登录</a>
                </li>
            </ul>

            <div class="sidebar-footer container">
                <img src="../../static/emoji-1.png">
            </div>
        </nav>

        <!-- Page Content  -->
        <div id="content">

            <nav class="navbar floating-navbar navbar-expand-lg navbar-light bg-light shadow">
                <div class="container-fluid">

                    <button type="button" id="sidebarCollapse" class="btn btn-info">
                        <i class="fas fa-align-justify"></i>
                    </button>

                    <ul class="nav ml-auto d-flex">
                        <li class="nav-item my-auto">
                            <a class="nav-link" href="#">
                                <i class="fas fa-book text-muted" data-toggle="tooltip" data-placement="bottom" title="使用指南"></i>
                            </a>
                        </li>
                        <li class="nav-item my-auto">
                            <a class="nav-link" href="#">
                                <i class="fas fa-user text-muted" data-toggle="tooltip" data-placement="bottom" title="用户中心"></i>
                            </a>
                        </li>
                        <li class="nav-item my-auto">
                            <a class="nav-link" href="#">
                                <i class="fas fa-bell text-muted" data-toggle="tooltip" data-placement="bottom" title="我的消息"></i>
                            </a>
                        </li>
                        <li class="nav-item my-auto">
                            <img src="../../static/avatars/shiroko.png" class="user-avatar ml-4">
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-6 col-md-12 col-sm-12 pl-0 pr-lg-2 pr-md-0 pr-sm-0 my-3">
                        <div class="card greeting-card">
                            <div class="card-body text-center">
                                <div class="row px-4">
                                    <img src="../../static/emoji-2.png" class="col-6 d-lg-block d-md-block">
                                    <div class="col-lg-6 col-md-6 col-sm-6 py-4 align-middle">
                                        <div class="icon">
                                            <i class="fas fa-train text-white"></i>
                                        </div> 
                                        <div class="text-center text-light" style="float: none; vertical-align: middle;">
                                            <h2>添加列车</h2>
                                            <p class="text-light">在这里您可以向系统中添加列车</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6 pl-lg-2 pl-md-0 pl-sm-0 pr-2 my-3">
                        <div class="card shadow-sm border-0 mb-4 mt-0">
                            <div class="card-body">
                                <div class="card-info float-left mb-0">
                                    <h3 class="mb-0">10 <small>Lv.</small></h3>
                                    <small class="text-muted mb-0">用户权限</small>
                                </div>
                                <div class="float-right pr-1">
                                    <div class="card-icon">
                                        <i class="fas fa-unlock-keyhole"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card shadow-sm border-0 mt-4 mb-0">
                            <div class="card-body">
                                <div class="card-info float-left mb-0">
                                    <h3 class="mb-0">10 <small>lv.</small></h3>
                                    <small class="text-muted mb-0">用户权限</small>
                                </div>
                                <div class="float-right pr-1">
                                    <div class="card-icon">
                                        <i class="fas fa-unlock-keyhole"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6 pl-2 pr-0 my-3">
                        <div class="card shadow-sm border-0 mb-4 mt-0">
                            <div class="card-body">
                                <div class="card-info float-left mb-0">
                                    <h3 class="mb-0">10 <small>Lv.</small></h3>
                                    <small class="text-muted mb-0">用户权限</small>
                                </div>
                                <div class="float-right pr-1">
                                    <div class="card-icon">
                                        <i class="fas fa-unlock-keyhole"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card shadow-sm border-0 mt-4 mb-0">
                            <div class="card-body">
                                <div class="card-info float-left mb-0">
                                    <h3 class="mb-0">10 <small>lv.</small></h3>
                                    <small class="text-muted mb-0">用户权限</small>
                                </div>
                                <div class="float-right pr-1">
                                    <div class="card-icon">
                                        <i class="fas fa-unlock-keyhole"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </div>

            </div>

            <div class="line"></div>

            <div class="container-fluid">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/index">首页</a></li>
                        <li class="breadcrumb-item"><a href="/admin/index">管理员主页</a></li>
                        <li class="breadcrumb-item active" aria-current="page"><a href="#">添加列车</a></li>
                    </ol>
                </nav>

                <h2>添加系统列车 <span class="badge badge-pill badge-info font-size-lg" style="font-size: 0.85rem;">管理员模式</span></h2>
                <p class="text-muted">若有任何疑问，请查看<a href="#" class="text-info">使用指南</a>。</p>    

            </div>

            <div class="line"></div>

            <div class="container">
                <form class="my-2">
                    <div class="form-group">
                        <label for="input-username">列车ID</label>
                        <input type="username" class="form-control" id="id" placeholder="请输入新列车的ID">
                    </div>
                    <div class="form-group">
                        <label for="input-username">列车类型</label>
                        <input type="username" class="form-control" id="type" placeholder="请输入新列车的类型">
                    </div>
                    <div class="form-group">
                        <label for="input-username">发车时间</label>
                        <input type="username" class="form-control" id="time" placeholder="请输入新列车的发车时间">
                        <small class="form-text text-muted">请以hh:mm的形式给出, 如 13:04. </small>
                    </div>
                    <div class="form-group">
                        <label for="input-username">贩售区间</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">起售日</span>
                            </div>
                            <input type="username" class="form-control" id="start" placeholder="请输入新列车开始发车的日期">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">止售日</span>
                            </div>
                            <input type="username" class="form-control" id="end" placeholder="请输入新列车停止发车的日期">
                        </div>
                        <small class="form-text text-muted">请以mm-dd的形式给出, 如 06-18. </small>
                    </div>
                    <div class="form-group">
                        <label for="input-username">座位总数</label>
                        <input type="username" class="form-control" id="seatnum" placeholder="请输入新列车的总座位数">
                    </div>
                    <div class="form-group">
                        <label for="input-username">站点信息</label>

                        <input type="username" class="form-control" id="stanum" placeholder="请输入新列车经过的站点总数">

                        <button type="button" class="btn btn-info btn-sm my-2" id="inc-station">增加一站</button>
                        <button type="button" class="btn btn-info btn-sm my-2" id="dec-station">减少一站</button>

                        <div id="stations">

                            <div class="input-group station-info">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">站名</span>
                                </div>
                                <input type="username" class="form-control" name="name" placeholder="该站的名称">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">行车时间</span>
                                </div>
                                <input type="username" class="form-control" name="travel" placeholder="列车行驶到下一站的用时">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">停留时间</span>
                                </div>
                                <input type="username" class="form-control" name="stop" placeholder="列车在该站停留的时间">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">票价</span>
                                </div>
                                <input type="username" class="form-control" name="price" placeholder="列车到下一站的票价">
                            </div>

                            <div class="input-group station-info">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">站名</span>
                                </div>
                                <input type="username" class="form-control" name="name" placeholder="该站的名称">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">行车时间</span>
                                </div>
                                <input type="username" class="form-control" name="travel" placeholder="列车行驶到下一站的用时">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">停留时间</span>
                                </div>
                                <input type="username" class="form-control" name="stop" placeholder="列车在该站停留的时间">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">票价</span>
                                </div>
                                <input type="username" class="form-control" name="price" placeholder="列车到下一站的票价">
                            </div>

                        </div>

                        <small class="form-text text-muted">用时单位为min, 票价单位为RMB </small>

                    </div>
                    <button type="button" class="btn bg-info text-light rounded" id="submit">
                        <i class="fas fa-train"></i>
                        添加列车
                    </button>
                </form>

            </div>


        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/javascript">
        $(function() {
            let staHtml = '<div class="input-group station-info">\
                                <div class="input-group-prepend">\
                                    <span class="input-group-text">站名</span>\
                                </div>\
                                <input type="username" class="form-control" name="name" placeholder="该站的名称">\
                                <div class="input-group-prepend">\
                                    <span class="input-group-text" id="basic-addon1">行车时间</span>\
                                </div>\
                                <input type="username" class="form-control" name="travel" placeholder="列车行驶到下一站的用时">\
                                <div class="input-group-prepend">\
                                    <span class="input-group-text" id="basic-addon1">停留时间</span>\
                                </div>\
                                <input type="username" class="form-control" name="stop" placeholder="列车在该站停留的时间">\
                                <div class="input-group-prepend">\
                                    <span class="input-group-text" id="basic-addon1">票价</span>\
                                </div>\
                                <input type="username" class="form-control" name="price" placeholder="列车到下一站的票价">\
                            </div>'

            $("[data-toggle='tooltip']").tooltip();
            $("#inc-station").click(function() {
                $("#stations").append(staHtml);
            });
            $("#dec-station").click(function() {
                $("#stations .station-info:last").remove();
            });
        });
        $(document).ready(function () {
            $('#sidebarCollapse').click(function () {
                $('#sidebar, #content').toggleClass('active');
            });
        });

        $(function() {
            $("#submit").click(function() {
                
                let sta = new Array();
                let tra = new Array();
                let stp = new Array();
                let pri = new Array();
            
                $("#stations .station-info").children().each(function() {
                    if(this.name == 'name') sta.push(this.value);
                    if(this.name == 'travel') tra.push(this.value);
                    if(this.name == 'stop') stp.push(this.value);
                    if(this.name == 'price') pri.push(this.value);
                });
                
                let sendData = {
                    'id': $("#id").val(),
                    'type': $("#type").val(),
                    'time': $("#time").val(),
                    'start': $("#start").val(),
                    'end': $("#end").val(),
                    'seatnum': $("#seatnum").val(),
                    'stanum': $("#stanum").val(),
                    'station': sta,
                    'travel': tra,
                    'stop': stp,
                    'price': pri
                }

                $.ajax({
                    url: '/admin/add-train',
                    type: 'post',
                    data: sendData,
                    success: function(str) {
                        let data = JSON.parse(str) 
                        let code = data['code']
                        let res = data['data']
                        
                        if(code == "-1") {
                            alert("FAILED");
                        }
                        else {
                            alert("SUCCESS");
                        }
                    }
                });

            });
        });
    </script>
</body>

</html>